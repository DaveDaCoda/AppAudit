<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>AppAudit</title>
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/landing-page.css" rel="stylesheet">
    <link href="css/report.css" rel="stylesheet">
    <link href="css/myshape.css" rel="stylesheet">
    <link href="css/bs-callout.css" rel="stylesheet">
    <link href="bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-61168812-1');
    ga('send', 'pageview');

    </script>
    <!-- End Google Analytics -->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation">
        <div class="container topnav">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a class="navbar-brand topnav" href="http://appaudit.io">
                    <img alt="Logo" src="img/logo.png" /> AppAudit
                </a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://github.com/mingyuan-xia/AppAudit">Developers</a>
                    </li>
                    <li>
                        <a href="research.html">Research</a>
                    </li>
                    <li>
                        <a href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Header -->
    <a name="about"></a>
    <div class="intro-header">
        <div class="container">

            <div class="row">
                <div class="col-lg-12">
                    <div class="intro-message">
                        <h2>AppAudit: Uncover Hidden Data Leaks in Apps</h2>
                        <hr class="intro-divider">
                        <p></p>
                        <input type="file" id="apkpath" class="hidden">
                        <div class="btn-group btn-group-lg">
                          <div class="btn-group" role="group">
                            <a class="btn btn-default btn-lg"><i id="widget-icon" class="fa fa-file-o"></i></a>
                          </div>
                          <div class="btn-group" role="group">
                            <a class="btn btn-default btn-lg" id="widget-btn">Select and Scan</a>
                          </div>
                          <div class="btn-group" role="group">
                            <a class="btn btn-default btn-lg dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#"><i class="fa fa-link"></i> Scan a Google Play URL (available soon)</a></li>
                            </ul>
                          </div>
                        </div><!-- /btn-group -->
                    </div>
                </div>
            </div>

        </div>
        <!-- /.container -->

    </div>
    <!-- /.intro-header -->

    <!-- Page Content -->
    <div class="modal fade" id="report-modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Scan report</h4>
          </div>
          <div class="modal-body">
            <div id="upload-scan"></div>
          </div>
          <div class="modal-footer">
            <div class="btn-group btn-group-lg">
              <div class="btn-group" role="group">
                <a class="btn btn-default"><i class="fa fa-envelope-o"></i></a>
              </div>
              <div class="btn-group" role="group">
                <a class="btn btn-default"><i class="fa fa-facebook"></i></a>
              </div>
              <div class="btn-group" role="group">
                <a class="btn btn-default"><i class="fa fa-twitter"></i></a>
              </div>
              <div class="btn-group" role="group">
                <a class="btn btn-default"><i class="fa fa-linkedin"></i></a>
              </div>
            </div>
            <a class="btn btn-primary" data-dismiss="modal">Close</a>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

	<a  name="services"></a>
    <div class="content-section-b" id="upload">

        <div class="container">
            <div class="clearfix"></div>
            <h2 class="section-heading"><i class="fa fa-bomb"></i> Top  threats from app markets - stay alerted!</h2>
            <div class="row">
                <div id="threats0" class="col-md-4 col-xs-12"></div>
                <div id="threats1" class="col-md-4 col-xs-12"></div>
                <div id="threats2" class="col-md-4 col-xs-12"></div>
            </div>
        </div>
        <!-- /.container -->

    </div>
    <!-- /.content-section-a -->

    <div class="content-section-a" id="headline">
        <div class="container">
            <div class="row">
                <div class="col-lg-7 text-center">
                    <div id="stats-tab" class="btn-group" role="group" aria-label="...">
                    </div>
                    <br>
                    <canvas id="stats-chart" height="200" width="500"></canvas>
                </div>
                <div class="col-lg-5">
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading"><i class="fa fa-line-chart"></i> AppAudit daily new scans</h2>
                    <p class="lead">AppAudit operates a huge scan network that intercepts latest app threats and keeps our users protected.</p>
                </div>
            </div>
        </div>
        <!-- /.container -->
    </div>

    <!-- /.content-section-b -->
    <div class="content-section-b" id="ourapp">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-sm-6">
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Upcoming: AppAudit Mobile</h2>
                    <p class="lead">AppAudit mobile protects users from potential app threats, including malware, data-leaking apps and fake apps.</p>
                </div>
                <div class="col-lg-5 col-lg-offset-1 col-sm-6 text-center">
                    <img class="img-responsive" src="img/phone.png" />
                </div>
            </div>
        </div>
    <!-- /.content-section-a -->
    </div>

	<a  name="contact"></a>
    <div class="banner">

        <div class="container">

            <div class="row">
                <div class="col-lg-3 text-center">
                    <h2>Contact AppAudit:</h2>
                </div>
                <div class="col-lg-3 text-center">
                    <i class="fa fa-flask fa-4x"></i>
                    <h3>New ideas?</h3>
                    <a href="mailto:dev@appaudit.io">dev@appaudit.io</a>
                </div>
                <div class="col-lg-3 text-center">
                    <i class="fa fa-lightbulb-o fa-4x"></i>
                    <h3>Have a need?</h3>
                    <a href="mailto:dev@appaudit.io">marketing@appaudit.io</a>
                </div>
                <div class="col-lg-3 text-center">
                    <i class="fa fa-share-alt fa-4x"></i>
                    <h3>Follow AppAudit</h3>
                    <a href="https://twitter.com/appauditio" class="btn btn-default"><i class="fa fa-twitter fa-2x"></i></a>
                    <a href="https://github.com/mingyuan-xia/AppAudit" class="btn btn-default"><i class="fa fa-github fa-2x"></i></a>
                    <a href="#" class="btn btn-default"><i class="fa fa-linkedin fa-2x"></i></a>
                </div>
            </div>

        </div>
        <!-- /.container -->

    </div>
    <!-- /.banner -->

    <!-- Footer -->
    <footer id="contact">
        <div class="container text-center">
            <div class="row">
                <div class="col-lg-12">
                    <ul class="list-inline">
                        <li>
                            <a href="terms.html">Terms of Service</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="privacy.html">Privacy Policy</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="mailto:info@appaudit.io">Contact</a>
                        </li>
                    </ul>
                    <p class="copyright text-muted small">Copyright &copy; AppAudit 2015. All Rights Reserved</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="bower_components/Chart.js/Chart.min.js"></script>
    <script src="bower_components/jsrender/jsrender.min.js"></script>
    <script src="bower_components/jquery.cookie/jquery.cookie.js"></script>
    <script src="js/desktop-notify-min.js"></script>
    <script src="js/frontend.js"></script>
    <script src="js/sha1.js"></script>
    <script src="js/api.js"></script>
    <script>
    Array.prototype.shuffle = function() {
        for (var i = this.length - 1; i > 0; --i) {
            var j = Math.floor(Math.random() * (i+1));
            var t = this[i];
            this[i] = this[j];
            this[j] = t;
        }
    }
    var render_examples = function(threats) {
        threats.shuffle();
        var tmpl = $.render.content_tmpl;
        show_report(threats[0], function (data) {
            renderData(data, $('#threats0'), tmpl);
        });
        show_report(threats[1], function (data) {
            renderData(data, $('#threats1'), tmpl);
        });
        show_report(threats[2], function (data) {
            renderData(data, $('#threats2'), tmpl);
        });
    }
    var render_stats = function(stats) {
        render_examples(stats.threats);
        $('#stats-tab').empty();
        for (var p in stats.plots) {
            var a = document.createElement('a');
            $(a).addClass('btn');
            $(a).addClass('btn-default');
            $(a).text(p);
            jQuery.data(a, 'chart', stats.plots[p]);
            $(a).appendTo($('#stats-tab'));
            $(a).click(function () {
                var last = $('#stats-tab a.btn-primary');
                last.removeClass('btn-primary');
                last.addClass('btn-default');
                $(this).addClass('btn-primary');
                var ctx = $("#stats-chart").get(0).getContext("2d");
                var data = $(this).data('chart');
                var lastChart = $("#stats-chart").data('lastChart');
                if (lastChart)
                    lastChart.destroy();
                lastChart = new Chart(ctx).Line(data);
                $("#stats-chart").data('lastChart', lastChart);
            });
        }
        $('#stats-tab a:first').click();
    }
    var set_widget_state = function(icon, text, allow_click) {
        $('#widget-icon').attr('class', icon);
        $('#widget-btn').html(text);
        $('#widget-btn').attr("disabled", !allow_click);
    }
    var reset_widget_state = function () {
        set_widget_state('fa fa-file-o', 'Select and Scan', true)
    }
    var upload_file = function (f) {
        var fd = new FormData();
        fd.append('apk', f);
        set_widget_state('fa fa-spinner fa-pulse', 'Uploading...', false);
        $.ajax({
            url: api_server+'upload',
            type: 'POST',
            data: fd,
            processData: false,
            contentType: false,
            success: function (res) {
                set_widget_state('fa fa-check', 'Upload succeeded', false);
                setTimeout(function() {
                    set_widget_state('fa fa-cog fa-spin', 'Analyzing...', false);
                }, 2000);
                console.log('upload success, res:' + res);
            },
            error: function (jqXHR, textStatus, err) {
                set_widget_state('fa fa-close', 'Upload failed', false);
                setTimeout(reset_widget_state, 2000);
                console.log('upload failed');
                console.log(err);
            }
        });
    }
    var popup_report = function(report) {
        $('#report-modal').modal();
        var tmpl = $.render.content_tmpl;
        $('#upload-scan').empty();
        renderData(report, $('#upload-scan'), tmpl);
    }
    var track_progress = function(psha1) {
        var poll_progress = function() {
            console.log('tracking ' + psha1);
            find_report(psha1, function (msg) {
                console.log(msg);
                if ('status_msg' in msg && msg.status_msg.indexOf('scanned') != -1) {
                    popup_report(msg);
                    reset_widget_state();
                } else {
                    setTimeout(poll_progress, 1500);
                }
            });
        }
        poll_progress();
    }
    var query_file = function() {
        var rawf = document.getElementById('apkpath').files[0];
        if (!rawf) 
            return ;
        var f = rawf.slice(0, 4096);
        var reader = new FileReader();
        reader.onloadend = function (e) {
            var content = e.target.result;
            var hash = sha1.hash(content);
            find_report(hash, function (data) {
                if (data.status_msg.indexOf('scanned') != -1) {
                    popup_report(data);
                } else {
                    track_progress(hash);
                    upload_file(rawf);
                }
            });
        }
        reader.readAsArrayBuffer(f);
    }
    $(document).ready(function() {
        $.get('js/report-tmpl', function (tmplData) {
            $.templates({content_tmpl: tmplData});
            get_stats(render_stats);
            $('#widget-btn').click(function (e) {
                $('input[id=apkpath]').click()
            });
            $('input[id=apkpath]').change(query_file);
        });
    });
    </script>
</body>

</html>
